<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>as operator in Rust | Dev. note</title>
<meta name="keywords" content="rust, type">
<meta name="description" content="안녕하세요.
오늘은 Rust의 as 를 사용한 type casting에 대해 알아보고자 합니다. C&#43;&#43; 프로그램에서는 잘못된 type 사용 으로 인한 오류를 종종 볼 수 있습니다. uint64_t 값을 uint32_t 값에 대입하여 잘못된 값으로 동작하는 경우가 그 예입니다. 조금은 어이 없는 실수이긴 한데, 생각보다 자주 발견됩니다. 이런 류의 버그는 처음 봤을 때 원인을 가늠하기 힘들기도 하지만, 고치기 귀찮거나 어렵기도 합니다. Type 재정의를 사용하지 않는 경우도 많고, 가끔씩은 통일할 필요가 크게 없는 경우도 있고, 의미 상 같은 변수를 모두 찾아내기 힘든 코드들도 종종 있습니다.">
<meta name="author" content="Huijeong Kim">
<link rel="canonical" href="http://huijeong-kim.github.io/post/2023-05-02-rust-as-operator/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css" integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe&#43;FVUFzPh7U=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://huijeong-kim.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://huijeong-kim.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://huijeong-kim.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://huijeong-kim.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="http://huijeong-kim.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VHBQNPGKKB"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-VHBQNPGKKB', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="as operator in Rust" />
<meta property="og:description" content="안녕하세요.
오늘은 Rust의 as 를 사용한 type casting에 대해 알아보고자 합니다. C&#43;&#43; 프로그램에서는 잘못된 type 사용 으로 인한 오류를 종종 볼 수 있습니다. uint64_t 값을 uint32_t 값에 대입하여 잘못된 값으로 동작하는 경우가 그 예입니다. 조금은 어이 없는 실수이긴 한데, 생각보다 자주 발견됩니다. 이런 류의 버그는 처음 봤을 때 원인을 가늠하기 힘들기도 하지만, 고치기 귀찮거나 어렵기도 합니다. Type 재정의를 사용하지 않는 경우도 많고, 가끔씩은 통일할 필요가 크게 없는 경우도 있고, 의미 상 같은 변수를 모두 찾아내기 힘든 코드들도 종종 있습니다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://huijeong-kim.github.io/post/2023-05-02-rust-as-operator/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-05-02T19:00:30+09:00" />
<meta property="article:modified_time" content="2023-05-02T19:00:30+09:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="as operator in Rust"/>
<meta name="twitter:description" content="안녕하세요.
오늘은 Rust의 as 를 사용한 type casting에 대해 알아보고자 합니다. C&#43;&#43; 프로그램에서는 잘못된 type 사용 으로 인한 오류를 종종 볼 수 있습니다. uint64_t 값을 uint32_t 값에 대입하여 잘못된 값으로 동작하는 경우가 그 예입니다. 조금은 어이 없는 실수이긴 한데, 생각보다 자주 발견됩니다. 이런 류의 버그는 처음 봤을 때 원인을 가늠하기 힘들기도 하지만, 고치기 귀찮거나 어렵기도 합니다. Type 재정의를 사용하지 않는 경우도 많고, 가끔씩은 통일할 필요가 크게 없는 경우도 있고, 의미 상 같은 변수를 모두 찾아내기 힘든 코드들도 종종 있습니다."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://huijeong-kim.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "as operator in Rust",
      "item": "http://huijeong-kim.github.io/post/2023-05-02-rust-as-operator/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "as operator in Rust",
  "name": "as operator in Rust",
  "description": "안녕하세요.\n오늘은 Rust의 as 를 사용한 type casting에 대해 알아보고자 합니다. C++ 프로그램에서는 잘못된 type 사용 으로 인한 오류를 종종 볼 수 있습니다. uint64_t 값을 uint32_t 값에 대입하여 잘못된 값으로 동작하는 경우가 그 예입니다. 조금은 어이 없는 실수이긴 한데, 생각보다 자주 발견됩니다. 이런 류의 버그는 처음 봤을 때 원인을 가늠하기 힘들기도 하지만, 고치기 귀찮거나 어렵기도 합니다. Type 재정의를 사용하지 않는 경우도 많고, 가끔씩은 통일할 필요가 크게 없는 경우도 있고, 의미 상 같은 변수를 모두 찾아내기 힘든 코드들도 종종 있습니다.",
  "keywords": [
    "rust", "type"
  ],
  "articleBody": "안녕하세요.\n오늘은 Rust의 as 를 사용한 type casting에 대해 알아보고자 합니다. C++ 프로그램에서는 잘못된 type 사용 으로 인한 오류를 종종 볼 수 있습니다. uint64_t 값을 uint32_t 값에 대입하여 잘못된 값으로 동작하는 경우가 그 예입니다. 조금은 어이 없는 실수이긴 한데, 생각보다 자주 발견됩니다. 이런 류의 버그는 처음 봤을 때 원인을 가늠하기 힘들기도 하지만, 고치기 귀찮거나 어렵기도 합니다. Type 재정의를 사용하지 않는 경우도 많고, 가끔씩은 통일할 필요가 크게 없는 경우도 있고, 의미 상 같은 변수를 모두 찾아내기 힘든 코드들도 종종 있습니다. 테스트를 더 잘 하면 된다고 하지만, 모든 변수에 대해 boundary test를 하는 건 현실적으로 조금 어렵습니다.\nRust에서는 엄격하게 type 검사를 합니다. Rust로 작성할 땐 u64를 u32에 대입할 수 없습니다. into() 혹은 try_into() 등을 통해 type conversion하여야 하고, 적절하지 못한 type 변환 시도는 컴파일 타임에 발견되거나 런타임에 에러 리턴이 됩니다. 그래서 Rust 사용 시에는 type 관련해서는 매우 안심하고 있었는데, 생각치 못한 예외가 있더라고요. 바로 as를 사용한 type casting 입니다.\nas는 Rust의 type cast operator 입니다. Reference book와 std reference를 참고하여 그 용도를 정리하고, type casting과 type conversion 으로 막을 수 있는/없는 invalid casting을 살펴보겠습니다.\nType casting as는 primitive 의 type casting에 사용됩니다. Type을 강제 할당하는 것이기 때문에, 런타임 casting 실패는 존재하지 않습니다. 하지만 casting이 가능한 케이스는 한정되어 있습니다. 그 외의 경우는 compile time에 invalid casting으로 실패합니다.\nNumeric cast 동일 size integer: no-op smaller integer -\u003e larger integer: zero/sign-extend larger integer -\u003e smaller integer: truncate (!!) 제가 최근에 습관적으로 as를 사용하였는데, 이 경우 특별한 경고(compile error/warning 등) 없이 값을 잃을 수 있더라고요. as는 type 변환이 아닌 casting을 해 주는 것 이기 때문에 사용에 주의해야 할 것 같습니다.\n1 2 3 let number: u64 = u64::MAX; let cast_as = number as u32; println!(\"Numbers: {:x}, {:x}\", number, cast_as); 실행 결과\n1 Numbers: ffffffffffffffff, ffffffff Numeric casting 하고 싶을 때는 as를 사용한 casting 대신 into() 혹은 try_into()를 사용하여 type conversion을 하는 것이 좋겠습니다. 위와 같은 예제에서 into()를 사용하면, u32에 대한 From는 구현되어 있지 않다는 이유로 compile error가 발생합니다. 물론 직접 into() 함수를 구현할 수도 있겠지만 굳이 그럴 필욘 없겠지요. try_into()를 사용한다면 결과값은 TryFromIntError 에러가 됩니다.\n1 2 3 4 5 // error[E0277]: the trait bound `u32: From` is not satisfied //let cast_into: u32 = number.into(); let cast_into: Result\u003cu32, _\u003e = number.try_into(); println!(\"Conversion result: {:?}\", cast_into); 실행 결과\n1 Conversion result: Err(TryFromIntError(())) Enum cast Enum의 numeric casting 도 가능합니다. 단,\nUnit-only enums Field-less enums (without explicit discriminants) 만 가능합니다. Field-less enum은 “no constructors contain fields” 인 enum 입니다. Tuple, Struct 와 같은 enum 값이 있더라도 그 안에 field가 없는 경우를 말하는 것 같습니다. 이 경우에는 explicit discriminants(=3 과 같은 값 지정)가 없어야만 numeric casting 가능합니다.\n1 2 3 4 5 6 7 8 9 10 11 #[derive(Debug)] enum FieldOnlyEnum { Tuple(), Struct{}, Unit, } println!(\"FieldOnlyEnum: Tuple {:?}, Struct {:?}, Unit {}\", FieldOnlyEnum::Tuple() as u8, FieldOnlyEnum::Struct{} as u32, FieldOnlyEnum::Unit as u8); 실행 결과\n1 FieldOnlyEnum: Tuple 0, Struct 1, Unit 2 여기에 FieldOnlyEnum::Unit에 Unit = 1,과 같이 명시적으로 값을 지정하면 “discriminant value 1 assigned more than once” 에러가 발생합니다. 하지만 enum에 #[repr(u8)] 지정할 경우 explicit discriminant가 있는 field-less enum에서도 numeric casting 가능하다고 합니다. 이 때 tuple type이나 struct type에 discriminant value 지정하는 경우에는 *“non-primitive cast”*로 compile error 발생합니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 #[derive(Debug)] #[repr(u8)] enum FieldOnlyEnum2 { OtherUnit = 3, Tuple(), Struct{}, Unit, } println!(\"FieldOnlyEnum2: Tuple {:?}, Struct {:?}, Unit {}\", FieldOnlyEnum2::Tuple() as u8, FieldOnlyEnum2::Struct{} as u32, FieldOnlyEnum2::Unit as u8); 실행 결과\n1 FieldOnlyEnum2: Tuple 4, Struct 5, Unit 6 여기서 또 한 가지 신기한 점은, casting 시 FieldOnlyEnum::Struct as u8 와 같이 작성하는 경우(생성자 사용 X)엔 compile error 가 발생하고, FieldOnlyEnum::Tuple as u8 로 작성하면 빌드는 성공하나 값이 이상하게 FieldOnlyEnum: Tuple 224, Struct 1, Unit 2 로 나오더라고요. 혼란스럽지만 이런 enum type casting이 얼마나 필요할 지 모르겠으니 그냥 넘어가 보겠습니다..\nUnit-only enum은 field-less enum 중 unit으로만 이루어진 경우입니다. 이 때는 Field-only enum과 다르게 *“explicit discriminant value”*를 갖고 있어도 상관 없습니다. 아래 코드에서 주석 처리 된 것 처럼 UnitNum3이 i32란 field를 갖고 있는 경우(unit-only enum이 아닌 경우), 모든 type casting에서 에러가 발생합니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #[derive(Debug)] enum UnitOnlyEnum1 { UnitNum, UnitNum2, UnitNum3, //UnitNum3(i32), =\u003e error[E0605]: non-primitive cast: `UnitOnlyEnum1` as `u32` } println!(\"UnitOnlyEnum: UnitNum {}, UnitNum2 {} UnitNum3 {}\", UnitOnlyEnum1::UnitNum as u8, UnitOnlyEnum1::UnitNum2 as u16, UnitOnlyEnum1::UnitNum3 as u32, ); enum UnitOnlyEnum2 { UnitNum = 1, UnitNum2 = 4, } println!(\"UnitOnlyEnum2: UnitNum {}, UnitNum2 {}\", UnitOnlyEnum2::UnitNum as u32, UnitOnlyEnum2::UnitNum2 as u32, ); 실행 결과\n1 2 UnitOnlyEnum: UnitNum 0, UnitNum2 1, UnitNum3 2 UnitOnlyEnum2: UnitNum 1, UnitNum2 4 Other primitives false -\u003e 0, true -\u003e 1 char -\u003e numerics: 해당 char code numerics -\u003e char: 해당하는 char code의 char numerics -\u003e char 변환은 u8만 가능합니다. 그보다 큰 값을 가진 emoji 들은 try_into나 into를 사용해 type conversion 하면 되겠습니다.\n업데이트 (23.5.7) char 타입은 “Unicode scalar value” 를 의미하며, 1B로 표현 됩니다. Unicode 글자만이 char로 type casting 가능하다고 보면 될 것 같습니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 println!(\"False as u8: {}\", false as u8); println!(\"True as u8: {}\", true as u8); println!(\"'C' as u8: {}\", 'C' as u8); println!(\"67 as char: {}\", 67 as char); println!(\"'❤️' as u32: {}\", '❤' as u32); // error: only `u8` can be cast into `char` //println!(\"10084 as char: {}\", 10084 as char); //error[E0604]: only `u8` can be cast as `char`, not `u32` //println!(\"10084 as char: {}\", 10084u32 as char); let result: Result\u003cchar, _\u003e = (10084 as u32).try_into(); println!(\"Converting result: {:?}\", result); // error[E0277]: the trait bound `char: From` is not satisfied // let result: char = (10084 as u32).into(); // println!(\"Converting result: {:?}\", result); 실행 결과\n1 2 3 4 5 6 False as u8: 0 True as u8: 1 'C' as u8: 67 67 as char: C '❤️' as u32: 10084 Converting result: Ok('❤') pointer to address cast의 경우 예상하는 바와 유사한 것 같습니다. casting 되는 type에 따라 값이 truncate 되어 잘못된 주소를 반환할 수 있으니 주의해야 합니다. usize 로 casting 하거나, 다음과 같이 _를 사용하여 컴파일러가 추론하게 만들 수도 있습니다.\n1 2 3 let num = 42; let address = \u0026num as *const _; println!(\"The address of num is {:?}\", address); 실행 결과\n1 The address of num is 0x7fffd6002dfc Type coercions Type 을 강제할 때 사용합니다. 흔히 사용하는 literal 에 type 지정하는 경우가 그 예입니다. 이 때 잘못된 casting을 하면 (e.g., 너무 큰 값을 u8로 casting) compile error가 발생합니다.\n1 2 3 4 5 6 let number_coercions = 123 as u8; // error: literal out of range for `u8` //let number_coercions2 = 10002 as u8; println!(\"numbers: {}\", number_coercions); 실행 결과\n1 numbers: 123 또 다른 예는 Trait 으로의 변환입니다. 다음과 같이 \u0026dyn Animal trait 으로 casting 하여 해당 trait의 함수를 사용할 수 있습니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use std::any::Any; trait Animal { fn speak(\u0026self); } #[derive(Debug)] struct Dog { name: String, } impl Animal for Dog { fn speak(\u0026self) { println!(\"{} says woof!\", self.name); } } fn trait_coercions() { let dog = Dog { name: String::from(\"Happy\") }; let animal = \u0026dog as \u0026dyn Animal; animal.speak(); } 실행 결과\n1 Happy says woof! 근데 casting 없이 그냥 호출해도 되고, 다음과 같이 함수 인자로 전달하면 자연스럽게(암묵적으로) casting 되는데, 위와 같이 as Trait 을 사용하는 경우가 어떤 경우인지 감이 오질 않네요.\n1 2 3 4 5 6 7 8 fn trait_coercions() { let dog = Dog { name: String::from(\"Happy\") }; let_animal_speak(dog); } fn let_animal_speak(animal: \u0026dyn Animal) { animal.speak(); } 실행 결과\n1 Happy says woof! 이 보다는 Trait을 downcasting를 하고 싶은 경우가 더 많을 것 같습니다. 꼭 downcasting을 해야 하겠느냐고 하면 할 말이 없지만(다른 방식으로 해결하는 게 좋은 경우가 더 많지만) 그래도 현실적으로 필요할 때가 종종 있습니다. 이 땐 std::any::Any::downcast_ref를 사용할 수 있습니다(참고). 이 과정에서 animal as \u0026dyn Any와 같이 casting 하면 downcast가 정상 동작하지 않는 등 예상대로 동작하지 않는데요. as_any() 의 신비는 다음에 기회 되면 알아보고 정리해 보겠습니다.\n다음 예제에서 Dog, Cat은 Animal trait을 구현하고 있고, Desk는 구현하고 있지 않습니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 trait Animal { fn speak(\u0026self); fn as_any(\u0026self) -\u003e \u0026dyn Any; } // .. 생략 .. impl Animal for Dog { // .. 생략 .. fn as_any(\u0026self) -\u003e \u0026dyn Any { self } } // .. 생략 .. let animal_vec: Vec\u003cBox\u003cdyn Animal\u003e\u003e = vec![ Box::new(Dog { name: String::from(\"Fido\") }), Box::new(Cat { name: String::from(\"Whiskers\") }), ]; for animal in animal_vec { animal.speak(); if let Some(dog) = animal.as_any().downcast_ref::\u003cDog\u003e() { println!(\"animal's name is {}\", dog.name); } } let desk = Desk { name: String::from(\"birch\") }; let desk_as_any = \u0026desk as \u0026dyn Any; let is_dog = desk_as_any.downcast_ref::\u003cDog\u003e(); println!(\"desk is dog?: {:?}\", is_dog); 실행 결과\n1 2 3 4 Fido says woof! animal's name is Fido Whiskers says meow! desk is dog?: None Rename imports 마지막으로 C++ 의 namespace renaming과 유사한 rename imports 가 있는데, 이는 type casting이 아니므로 생략합니다.\n결론 Rust 의 type casting은 C++ 대비 매우 제한적이고, 정의되지 않은 casting은 invalid casting으로 처리되는 것 같습니다. 하지만 이 기준을 Reference Book만 보고 파악하기는 조금 어렵더라고요.\n이번 편을 작성하다 보니, Type Casting이 꼭 필요한 경우는 사실 없지 않을까 싶었습니다.(Type Casting이 유용한 예가 있다면 공유해 주시길!!) 오늘도 조금 뻔한 결론, type casting 보다는 type conversion을 사용하여 암묵적인 변환으로 인해 발생할 수 있는 버그를 피하자로 마무리 하겠습니다.\n",
  "wordCount" : "1558",
  "inLanguage": "en",
  "datePublished": "2023-05-02T19:00:30+09:00",
  "dateModified": "2023-05-02T19:00:30+09:00",
  "author":{
    "@type": "Person",
    "name": "Huijeong Kim"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://huijeong-kim.github.io/post/2023-05-02-rust-as-operator/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Dev. note",
    "logo": {
      "@type": "ImageObject",
      "url": "http://huijeong-kim.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://huijeong-kim.github.io/" accesskey="h" title="Dev. note (Alt + H)">Dev. note</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://huijeong-kim.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://huijeong-kim.github.io/post/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://huijeong-kim.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://huijeong-kim.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://huijeong-kim.github.io/">Home</a>&nbsp;»&nbsp;<a href="http://huijeong-kim.github.io/post/">Posts</a></div>
    <h1 class="post-title">
      as operator in Rust
    </h1>
    <div class="post-meta"><span title='2023-05-02 19:00:30 +0900 KST'>2023-05-02</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1558 words&nbsp;·&nbsp;Huijeong Kim

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#type-casting" aria-label="Type casting">Type casting</a><ul>
                        
                <li>
                    <a href="#numeric-cast" aria-label="Numeric cast">Numeric cast</a></li>
                <li>
                    <a href="#enum-cast" aria-label="Enum cast">Enum cast</a></li>
                <li>
                    <a href="#other-primitives" aria-label="Other primitives">Other primitives</a></li></ul>
                </li>
                <li>
                    <a href="#type-coercions" aria-label="Type coercions">Type coercions</a></li>
                <li>
                    <a href="#rename-imports" aria-label="Rename imports">Rename imports</a></li>
                <li>
                    <a href="#%ea%b2%b0%eb%a1%a0" aria-label="결론">결론</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>안녕하세요.</p>
<p>오늘은 Rust의  <code>as</code> 를 사용한 type casting에 대해 알아보고자 합니다. C++ 프로그램에서는 잘못된 type 사용 으로 인한 오류를 종종 볼 수 있습니다. <code>uint64_t</code> 값을 <code>uint32_t</code> 값에 대입하여 잘못된 값으로 동작하는 경우가 그 예입니다. 조금은 어이 없는 실수이긴 한데, 생각보다 자주 발견됩니다. 이런 류의 버그는 처음 봤을 때 원인을 가늠하기 힘들기도 하지만, 고치기 귀찮거나 어렵기도 합니다. Type 재정의를 사용하지 않는 경우도 많고, 가끔씩은 통일할 필요가 크게 없는 경우도 있고, 의미 상 같은 변수를 모두 찾아내기 힘든 코드들도 종종 있습니다. 테스트를 더 잘 하면 된다고 하지만, 모든 변수에 대해 boundary test를 하는 건 현실적으로 조금 어렵습니다.</p>
<p>Rust에서는 엄격하게 type 검사를 합니다. Rust로 작성할 땐 <code>u64</code>를 <code>u32</code>에 대입할 수 없습니다. <code>into()</code> 혹은 <code>try_into()</code> 등을 통해 type conversion하여야 하고, 적절하지 못한 type 변환 시도는 컴파일 타임에 발견되거나 런타임에 에러 리턴이 됩니다. 그래서 Rust 사용 시에는 type 관련해서는 매우 안심하고 있었는데, 생각치 못한 예외가 있더라고요. 바로 <code>as</code>를 사용한 type casting 입니다.</p>
<p><code>as</code>는 Rust의 <strong>type cast operator</strong> 입니다. <a href="https://doc.rust-lang.org/reference/expressions/operator-expr.html#type-cast-expressions">Reference book</a>와 <a href="https://doc.rust-lang.org/std/keyword.as.html">std reference</a>를 참고하여 그 용도를 정리하고, type casting과 type conversion 으로 막을 수 있는/없는 invalid casting을 살펴보겠습니다.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="type-casting">Type casting<a hidden class="anchor" aria-hidden="true" href="#type-casting">#</a></h2>
<p><code>as</code>는 primitive 의 type casting에 사용됩니다. Type을 강제 할당하는 것이기 때문에, 런타임 casting 실패는 존재하지 않습니다. 하지만 casting이 가능한 케이스는 한정되어 있습니다. 그 외의 경우는 compile time에 <code>invalid casting</code>으로 실패합니다.</p>
<!-- raw HTML omitted -->
<h3 id="numeric-cast">Numeric cast<a hidden class="anchor" aria-hidden="true" href="#numeric-cast">#</a></h3>
<ul>
<li>동일 size integer: no-op</li>
<li>smaller integer -&gt; larger integer: zero/sign-extend</li>
<li>larger integer -&gt; smaller integer: truncate (!!)</li>
</ul>
<!-- raw HTML omitted -->
<p>제가 최근에 습관적으로 <code>as</code>를 사용하였는데, 이 경우 특별한 경고(compile error/warning 등) 없이 값을 잃을 수 있더라고요. <code>as</code>는 type 변환이 아닌 <strong>casting</strong>을 해 주는 것 이기 때문에 사용에 주의해야 할 것 같습니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> number: <span style="color:#8be9fd">u64</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd">u64</span>::MAX;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> cast_as <span style="color:#ff79c6">=</span> number <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u32</span>;
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;Numbers: </span><span style="color:#f1fa8c">{:x}</span><span style="color:#f1fa8c">, </span><span style="color:#f1fa8c">{:x}</span><span style="color:#f1fa8c">&#34;</span>, number, cast_as);
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Numbers: ffffffffffffffff, ffffffff
</span></span></code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<p>Numeric casting 하고 싶을 때는 <code>as</code>를 사용한 casting 대신 <code>into()</code> 혹은 <code>try_into()</code>를 사용하여 type conversion을 하는 것이 좋겠습니다.
위와 같은 예제에서 <code>into()</code>를 사용하면, <code>u32</code>에 대한 <code>From&lt;u64&gt;</code>는 구현되어 있지 않다는 이유로 compile error가 발생합니다. 물론 직접 <code>into()</code> 함수를 구현할 수도 있겠지만 굳이 그럴 필욘 없겠지요. <code>try_into()</code>를 사용한다면 결과값은 <code>TryFromIntError</code> 에러가 됩니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#6272a4">// error[E0277]: the trait bound `u32: From&lt;u64&gt;` is not satisfied
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">//let cast_into: u32 = number.into();
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> cast_into: <span style="color:#8be9fd;font-style:italic">Result</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">u32</span>, _<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">=</span> number.try_into();
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;Conversion result: </span><span style="color:#f1fa8c">{:?}</span><span style="color:#f1fa8c">&#34;</span>, cast_into);
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Conversion result: Err<span style="color:#ff79c6">(</span>TryFromIntError<span style="color:#ff79c6">(()))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<h3 id="enum-cast">Enum cast<a hidden class="anchor" aria-hidden="true" href="#enum-cast">#</a></h3>
<p>Enum의 numeric casting 도 가능합니다. 단,</p>
<ul>
<li>Unit-only enums</li>
<li>Field-less enums (without explicit discriminants)
만 가능합니다.</li>
</ul>
<!-- raw HTML omitted -->
<p><a href="https://doc.rust-lang.org/reference/items/enumerations.html#field-less-enum">Field-less enum</a>은 <em>&ldquo;no constructors contain fields&rdquo;</em> 인 enum 입니다. Tuple, Struct 와 같은 enum 값이 있더라도 그 안에 field가 없는 경우를 말하는 것 같습니다. 이 경우에는 explicit discriminants(<code>=3</code> 과 같은 값 지정)가 없어야만 numeric casting 가능합니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff79c6">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">enum</span> <span style="color:#50fa7b">FieldOnlyEnum</span> {
</span></span><span style="display:flex;"><span>    Tuple(),
</span></span><span style="display:flex;"><span>    Struct{},
</span></span><span style="display:flex;"><span>    Unit,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;FieldOnlyEnum: Tuple </span><span style="color:#f1fa8c">{:?}</span><span style="color:#f1fa8c">, Struct </span><span style="color:#f1fa8c">{:?}</span><span style="color:#f1fa8c">, Unit </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>,
</span></span><span style="display:flex;"><span>    FieldOnlyEnum::Tuple() <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u8</span>, 
</span></span><span style="display:flex;"><span>    FieldOnlyEnum::Struct{} <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u32</span>, 
</span></span><span style="display:flex;"><span>    FieldOnlyEnum::Unit <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u8</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>FieldOnlyEnum: Tuple 0, Struct 1, Unit <span style="color:#bd93f9">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<p>여기에 <code>FieldOnlyEnum::Unit</code>에 <code>Unit = 1,</code>과 같이 명시적으로 값을 지정하면 <em>&ldquo;discriminant value <code>1</code> assigned more than once&rdquo;</em> 에러가 발생합니다. 하지만 enum에 <code>#[repr(u8)]</code> 지정할 경우 explicit discriminant가 있는 field-less enum에서도 numeric casting 가능하다고 합니다. 이 때 tuple type이나 struct type에 discriminant value 지정하는 경우에는 *&ldquo;non-primitive cast&rdquo;*로 compile error 발생합니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff79c6">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">#[repr(u8)]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">enum</span> <span style="color:#50fa7b">FieldOnlyEnum2</span> {
</span></span><span style="display:flex;"><span>    OtherUnit <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">3</span>,
</span></span><span style="display:flex;"><span>    Tuple(),
</span></span><span style="display:flex;"><span>    Struct{},
</span></span><span style="display:flex;"><span>    Unit,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;FieldOnlyEnum2: Tuple </span><span style="color:#f1fa8c">{:?}</span><span style="color:#f1fa8c">, Struct </span><span style="color:#f1fa8c">{:?}</span><span style="color:#f1fa8c">, Unit </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>,
</span></span><span style="display:flex;"><span>    FieldOnlyEnum2::Tuple() <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u8</span>, 
</span></span><span style="display:flex;"><span>    FieldOnlyEnum2::Struct{} <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u32</span>, 
</span></span><span style="display:flex;"><span>    FieldOnlyEnum2::Unit <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u8</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>FieldOnlyEnum2: Tuple 4, Struct 5, Unit <span style="color:#bd93f9">6</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<p>여기서 또 한 가지 신기한 점은, casting 시 <code>FieldOnlyEnum::Struct as u8</code> 와 같이 작성하는 경우(생성자 사용 X)엔 compile error 가 발생하고, <code>FieldOnlyEnum::Tuple as u8</code> 로 작성하면 빌드는 성공하나 값이 이상하게 <code>FieldOnlyEnum: Tuple 224, Struct 1, Unit 2</code> 로 나오더라고요. 혼란스럽지만 이런 enum type casting이 얼마나 필요할 지 모르겠으니 그냥 넘어가 보겠습니다..</p>
<!-- raw HTML omitted -->
<p>Unit-only enum은 field-less enum 중 unit으로만 이루어진 경우입니다. 이 때는 Field-only enum과 다르게 *&ldquo;explicit discriminant value&rdquo;*를 갖고 있어도 상관 없습니다. 아래 코드에서 주석 처리 된 것 처럼 <code>UnitNum3</code>이 <code>i32</code>란 field를 갖고 있는 경우(unit-only enum이 아닌 경우), 모든 type casting에서 에러가 발생합니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">enum</span> <span style="color:#50fa7b">UnitOnlyEnum1</span> {
</span></span><span style="display:flex;"><span>    UnitNum,
</span></span><span style="display:flex;"><span>    UnitNum2,
</span></span><span style="display:flex;"><span>    UnitNum3, <span style="color:#6272a4">//UnitNum3(i32), =&gt; error[E0605]: non-primitive cast: `UnitOnlyEnum1` as `u32`
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;UnitOnlyEnum: UnitNum </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">, UnitNum2 </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c"> UnitNum3 </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>,
</span></span><span style="display:flex;"><span>    UnitOnlyEnum1::UnitNum <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u8</span>,
</span></span><span style="display:flex;"><span>    UnitOnlyEnum1::UnitNum2 <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u16</span>,
</span></span><span style="display:flex;"><span>    UnitOnlyEnum1::UnitNum3 <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u32</span>,
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">enum</span> <span style="color:#50fa7b">UnitOnlyEnum2</span> {
</span></span><span style="display:flex;"><span>    UnitNum <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>,
</span></span><span style="display:flex;"><span>    UnitNum2 <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">4</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;UnitOnlyEnum2: UnitNum </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">, UnitNum2 </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>,
</span></span><span style="display:flex;"><span>    UnitOnlyEnum2::UnitNum <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u32</span>,
</span></span><span style="display:flex;"><span>    UnitOnlyEnum2::UnitNum2 <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u32</span>,
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>UnitOnlyEnum: UnitNum 0, UnitNum2 1, UnitNum3 <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>UnitOnlyEnum2: UnitNum 1, UnitNum2 <span style="color:#bd93f9">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<h3 id="other-primitives">Other primitives<a hidden class="anchor" aria-hidden="true" href="#other-primitives">#</a></h3>
<ul>
<li>false -&gt; 0, true -&gt; 1</li>
<li>char -&gt; numerics: 해당 char code</li>
<li>numerics -&gt; char: 해당하는 char code의 char</li>
</ul>
<!-- raw HTML omitted -->
<p>numerics -&gt; char 변환은 <code>u8</code>만 가능합니다. 그보다 큰 값을 가진 emoji 들은 <code>try_into</code>나 <code>into</code>를 사용해 type conversion 하면 되겠습니다.</p>
<!-- raw HTML omitted -->
<p><strong>업데이트 (23.5.7)</strong>
<code>char</code> 타입은 &ldquo;Unicode scalar value&rdquo; 를 의미하며, 1B로 표현 됩니다. Unicode 글자만이 <code>char</code>로 type casting 가능하다고 보면 될 것 같습니다.</p>
<!-- raw HTML omitted -->
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;False as u8: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>, <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u8</span>);
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;True as u8: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>, <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u8</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;&#39;C&#39; as u8: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>, <span style="color:#f1fa8c">&#39;C&#39;</span> <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u8</span>);
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;67 as char: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>, <span style="color:#bd93f9">67</span> <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">char</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;&#39;❤️&#39; as u32: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>, <span style="color:#f1fa8c">&#39;❤&#39;</span> <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u32</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// error: only `u8` can be cast into `char`
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">//println!(&#34;10084 as char: {}&#34;, 10084 as char);
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//error[E0604]: only `u8` can be cast as `char`, not `u32`
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">//println!(&#34;10084 as char: {}&#34;, 10084u32 as char);
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> result: <span style="color:#8be9fd;font-style:italic">Result</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span>, _<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">=</span> (<span style="color:#bd93f9">10084</span> <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u32</span>).try_into();
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;Converting result: </span><span style="color:#f1fa8c">{:?}</span><span style="color:#f1fa8c">&#34;</span>, result);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// error[E0277]: the trait bound `char: From&lt;u32&gt;` is not satisfied
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">// let result: char = (10084 as u32).into();
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">// println!(&#34;Converting result: {:?}&#34;, result);
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>False as u8: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>True as u8: <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#39;C&#39;</span> as u8: <span style="color:#bd93f9">67</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">67</span> as char: C
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#39;❤️&#39;</span> as u32: <span style="color:#bd93f9">10084</span>
</span></span><span style="display:flex;"><span>Converting result: Ok<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;❤&#39;</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<p>pointer to address cast의 경우 예상하는 바와 유사한 것 같습니다. casting 되는 type에 따라 값이 truncate 되어 잘못된 주소를 반환할 수 있으니 주의해야 합니다. <code>usize</code> 로 casting 하거나, 다음과 같이 <code>_</code>를 사용하여 컴파일러가 추론하게 만들 수도 있습니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> num <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">42</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> address <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>num <span style="color:#ff79c6">as</span> <span style="color:#ff79c6">*</span><span style="color:#ff79c6">const</span> _;
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;The address of num is </span><span style="color:#f1fa8c">{:?}</span><span style="color:#f1fa8c">&#34;</span>, address);
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>The address of num is <span style="color:#bd93f9">0x7fffd6002dfc</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="type-coercions">Type coercions<a hidden class="anchor" aria-hidden="true" href="#type-coercions">#</a></h2>
<p>Type 을 강제할 때 사용합니다. 흔히 사용하는 literal 에 type 지정하는 경우가 그 예입니다. 이 때 잘못된 casting을 하면 (e.g., 너무 큰 값을 u8로 casting) compile error가 발생합니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> number_coercions <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">123</span> <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">u8</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// error: literal out of range for `u8`
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">//let number_coercions2 = 10002 as u8;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;numbers: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>, number_coercions);
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>numbers: <span style="color:#bd93f9">123</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<p>또 다른 예는 Trait 으로의 변환입니다. 다음과 같이 <code>&amp;dyn Animal</code> trait 으로 casting 하여 해당 trait의 함수를 사용할 수 있습니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff79c6">use</span> std::any::Any;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">trait</span> Animal {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">speak</span>(<span style="color:#ff79c6">&amp;</span>self);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">struct</span> <span style="color:#50fa7b">Dog</span> {
</span></span><span style="display:flex;"><span>    name: <span style="color:#8be9fd;font-style:italic">String</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">impl</span> Animal <span style="color:#ff79c6">for</span> Dog {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">speak</span>(<span style="color:#ff79c6">&amp;</span>self) {
</span></span><span style="display:flex;"><span>        println!(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c"> says woof!&#34;</span>, self.name);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">trait_coercions</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> dog <span style="color:#ff79c6">=</span> Dog { name: <span style="color:#8be9fd;font-style:italic">String</span>::from(<span style="color:#f1fa8c">&#34;Happy&#34;</span>) };
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> animal <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>dog <span style="color:#ff79c6">as</span> <span style="color:#ff79c6">&amp;</span><span style="color:#ff79c6">dyn</span> Animal;
</span></span><span style="display:flex;"><span>    animal.speak();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Happy says woof<span style="color:#ff79c6">!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<p>근데 casting 없이 그냥 호출해도 되고, 다음과 같이 함수 인자로 전달하면 자연스럽게(암묵적으로) casting 되는데, 위와 같이 <code>as Trait</code> 을 사용하는 경우가 어떤 경우인지 감이 오질 않네요.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">trait_coercions</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> dog <span style="color:#ff79c6">=</span> Dog { name: <span style="color:#8be9fd;font-style:italic">String</span>::from(<span style="color:#f1fa8c">&#34;Happy&#34;</span>) };
</span></span><span style="display:flex;"><span>    let_animal_speak(dog);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">let_animal_speak</span>(animal: <span style="color:#ff79c6">&amp;</span><span style="color:#50fa7b">dyn</span> Animal) {
</span></span><span style="display:flex;"><span>    animal.speak();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Happy says woof<span style="color:#ff79c6">!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<p>이 보다는 Trait을 downcasting를 하고 싶은 경우가 더 많을 것 같습니다. 꼭 downcasting을 해야 하겠느냐고 하면 할 말이 없지만(다른 방식으로 해결하는 게 좋은 경우가 더 많지만) 그래도 현실적으로 필요할 때가 종종 있습니다. 이 땐 <code>std::any::Any::downcast_ref</code>를 사용할 수 있습니다(<a href="https://bennett.dev/rust/downcast-trait-object/">참고</a>). 이 과정에서 <code>animal as &amp;dyn Any</code>와 같이 casting 하면 downcast가 정상 동작하지 않는 등 예상대로 동작하지 않는데요.  <code>as_any()</code> 의 신비는 다음에 기회 되면 알아보고 정리해 보겠습니다.</p>
<p>다음 예제에서 Dog, Cat은 <code>Animal</code> trait을 구현하고 있고, Desk는 구현하고 있지 않습니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff79c6">trait</span> Animal {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">speak</span>(<span style="color:#ff79c6">&amp;</span>self);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">as_any</span>(<span style="color:#ff79c6">&amp;</span>self) -&gt; <span style="color:#ff79c6">&amp;</span><span style="color:#50fa7b">dyn</span> Any;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// .. 생략 ..
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">impl</span> Animal <span style="color:#ff79c6">for</span> Dog {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// .. 생략 ..
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">as_any</span>(<span style="color:#ff79c6">&amp;</span>self) -&gt; <span style="color:#ff79c6">&amp;</span><span style="color:#50fa7b">dyn</span> Any {
</span></span><span style="display:flex;"><span>        self
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// .. 생략 ..
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> animal_vec: <span style="color:#8be9fd;font-style:italic">Vec</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd;font-style:italic">Box</span><span style="color:#ff79c6">&lt;</span><span style="color:#ff79c6">dyn</span> Animal<span style="color:#ff79c6">&gt;&gt;</span> <span style="color:#ff79c6">=</span> vec![
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">Box</span>::new(Dog { name: <span style="color:#8be9fd;font-style:italic">String</span>::from(<span style="color:#f1fa8c">&#34;Fido&#34;</span>) }),
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">Box</span>::new(Cat { name: <span style="color:#8be9fd;font-style:italic">String</span>::from(<span style="color:#f1fa8c">&#34;Whiskers&#34;</span>) }),
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> animal <span style="color:#ff79c6">in</span> animal_vec {
</span></span><span style="display:flex;"><span>    animal.speak();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">Some</span>(dog) <span style="color:#ff79c6">=</span> animal.as_any().downcast_ref::<span style="color:#ff79c6">&lt;</span>Dog<span style="color:#ff79c6">&gt;</span>() {
</span></span><span style="display:flex;"><span>        println!(<span style="color:#f1fa8c">&#34;animal&#39;s name is </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span>, dog.name);    
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> desk <span style="color:#ff79c6">=</span> Desk { name: <span style="color:#8be9fd;font-style:italic">String</span>::from(<span style="color:#f1fa8c">&#34;birch&#34;</span>) };
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> desk_as_any <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>desk <span style="color:#ff79c6">as</span> <span style="color:#ff79c6">&amp;</span><span style="color:#ff79c6">dyn</span> Any;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> is_dog <span style="color:#ff79c6">=</span> desk_as_any.downcast_ref::<span style="color:#ff79c6">&lt;</span>Dog<span style="color:#ff79c6">&gt;</span>();
</span></span><span style="display:flex;"><span>println!(<span style="color:#f1fa8c">&#34;desk is dog?: </span><span style="color:#f1fa8c">{:?}</span><span style="color:#f1fa8c">&#34;</span>, is_dog);
</span></span></code></pre></td></tr></table>
</div>
</div><p>실행 결과</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Fido says woof<span style="color:#ff79c6">!</span>
</span></span><span style="display:flex;"><span>animal&#39;s name is Fido
</span></span><span style="display:flex;"><span>Whiskers says meow<span style="color:#ff79c6">!</span>
</span></span><span style="display:flex;"><span>desk is dog<span style="color:#ff79c6">?:</span> None
</span></span></code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="rename-imports">Rename imports<a hidden class="anchor" aria-hidden="true" href="#rename-imports">#</a></h2>
<p>마지막으로 C++ 의 namespace renaming과 유사한 rename imports 가 있는데, 이는 type casting이 아니므로 생략합니다.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="결론">결론<a hidden class="anchor" aria-hidden="true" href="#결론">#</a></h2>
<!-- raw HTML omitted -->
<p>Rust 의 type casting은 C++ 대비 매우 제한적이고, 정의되지 않은 casting은 invalid casting으로 처리되는 것 같습니다. 하지만 이 기준을 Reference Book만 보고 파악하기는 조금 어렵더라고요.</p>
<p>이번 편을 작성하다 보니, Type Casting이 꼭 필요한 경우는 사실 없지 않을까 싶었습니다.(Type Casting이 유용한 예가 있다면 공유해 주시길!!) 오늘도 조금 뻔한 결론, type casting 보다는 type conversion을 사용하여 암묵적인 변환으로 인해 발생할 수 있는 버그를 피하자로 마무리 하겠습니다.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://huijeong-kim.github.io/tags/rust/">rust</a></li>
      <li><a href="http://huijeong-kim.github.io/tags/type/">type</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://huijeong-kim.github.io/post/2023-05-07-exploring-rust-strings/">
    <span class="title">« Prev</span>
    <br>
    <span>Exploring Rust Strings</span>
  </a>
  <a class="next" href="http://huijeong-kim.github.io/post/2023-01-29-rust-polymorphism/">
    <span class="title">Next »</span>
    <br>
    <span>Polymorphism in Rust</span>
  </a>
</nav>

  </footer><script src="https://utteranc.es/client.js"
        repo="huijeong-kim/huijeong-kim.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://huijeong-kim.github.io/">Dev. note</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
